# HIS 项目整体开发流程与 3 人分工（建议版）

> 目标：小团队仍然保持“可控节奏 + 可回滚 + 可追责”的工程质量。
> 规模：3 人（可全栈，但职责必须清晰）。

## 1. 角色分工（3 人）

### 角色 A：后端/数据负责人（Owner: API + DB）
- 维护数据库 DDL、迁移脚本、数据一致性策略（金额/库存/状态机）。
- 负责接口设计（OpenAPI/Swagger）、鉴权、权限、审计日志。
- 负责关键业务流程：挂号 -> 病历 -> 处方 -> 缴费（事务与幂等）。

### 角色 B：前端负责人（Owner: 交互 + 数据字典落地）
- 负责核心页面与组件实现：患者建档、挂号、病历、处方、收费。
- 负责前端校验、枚举展示、列表查询与表单体验。
- 与后端共同维护接口契约（字段、枚举、错误码、分页）。

### 角色 C：测试/交付负责人（Owner: 质量 + 发布）
- 负责测试用例、冒烟测试、回归测试；推动自动化（至少接口自动化 + 数据准备脚本）。
- 负责 CI/CD、环境管理（dev/test/staging/prod）、发布与回滚预案。
- 负责数据脚本与演示数据（必要时协助后端补脚本）。

> 约束：任何一个模块上线必须同时满足：接口契约完成、前端页面完成、测试用例覆盖、可回滚。

## 2. 迭代节奏（建议 1 周一个小迭代）

周一（需求与拆分）
- 30~60 分钟评审：确认本周范围、验收标准、字段与枚举。
- 输出 1 份“接口契约草案”（OpenAPI 或 Markdown 表格）。

周二~周四（开发 + 自测）
- 后端优先交付可跑的 Mock/接口（哪怕先返回假数据），前端可并行。
- 每个需求必须拆成：DB/接口/前端/测试 四类任务。

周五（联调 + 发布）
- 上午：联调冒烟（C 牵头），记录问题清单。
- 下午：合并主干、打版本、发 staging；如稳定再发 prod。

## 3. 接口契约与联调规则（减少扯皮）

- 单一事实来源：OpenAPI（或同等规格）作为接口唯一标准。
- 变更流程：任何字段/枚举/状态机变更必须先改契约，再改实现。
- 错误码规范：
  - 唯一冲突：返回可识别错误码（例如 `DUPLICATE_KEY`）+ 字段名。
  - 校验失败：返回字段级错误（用于前端就地提示）。
- 幂等要求：收费支付回写、发药等必须提供幂等键（例如 `transaction_no`）。

## 4. 分支与代码评审（小团队也要守住底线）

推荐：Trunk-based（简单有效）
- `main`：随时可发布。
- `feat/*`：短分支（≤2 天），PR 合并。
- 合并条件：
  - A/B 至少 1 人 Review；核心业务（金额/状态机）必须 A Review。
  - CI 通过（lint + 单元测试 + 接口测试/冒烟）。

## 5. 数据库与迁移（避免“脚本一把梭”进生产）

- 本地/测试可用初始化脚本；生产必须使用迁移工具（Flyway/Liquibase 二选一）。
- 迁移规范：
  - 只允许增量迁移（`V001__init.sql`, `V002__add_index.sql`）。
  - 每次发布必须带上对应迁移版本。
  - 严禁在生产执行 `DROP TABLE`/`session_replication_role='replica'` 这类全局破坏性操作。

## 6. 质量门禁（3 人也能做到的最小集合）

- 后端：
  - 单元测试覆盖关键状态机（挂号状态、处方状态、收费状态）。
  - 接口测试覆盖核心链路（创建挂号->建病历->开处方->收费）。
- 前端：
  - 至少有“冒烟脚本/清单”（关键页面能走通）。
  - 表单校验与枚举一致（以数据字典为准）。
- 交付：
  - 每次发布必须可回滚（保留上一版本镜像/包；迁移需可逆或提供补偿脚本）。

## 7. 建议的交付里程碑（按你现有 9 表范围）

里程碑 M1（第 1 周）：基础主数据
- 科室/医生/患者：CRUD + 列表查询 + 权限最小化。

里程碑 M2（第 2 周）：就诊闭环（不含支付）
- 挂号 + 病历（草稿/提交/审核）。

里程碑 M3（第 3 周）：处方与收费
- 处方主从 + 审核/发药（先不做真实库存流水也可以，但要留扩展点）
- 收费单创建 + 支付回写（先模拟支付也行）。

里程碑 M4（第 4 周）：稳定性与合规
- 日志审计、脱敏展示、更多校验约束、性能回归。
