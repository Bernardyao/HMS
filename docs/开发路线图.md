# HIS 项目开发路线图

> 本文档整合了后端、前端、测试三个维度的开发任务，作为项目的整体规划参考。

---

## 项目里程碑

### M1：基础主数据（已完成 ✅）
- 科室/医生/患者/药品的 CRUD
- 基础权限控制
- API 模块化重构

### M2：就诊闭环（部分完成）
- 挂号功能 ✅
- 病历管理 ✅
- 处方管理 ✅

### M3：工作站完善（已完成 ✅）
- 护士工作站 ✅
- 药师工作站 ✅
- 医生工作站 ✅

### M4：稳定性与合规（规划中）
- 脱敏展示优化
- 审计日志完善
- 性能优化

---

## 后端开发任务

### P0 - 核心功能（已完成）

#### 1. 认证与权限
- ✅ JWT 认证体系
- ✅ 角色权限控制（DOCTOR/NURSE/PHARMACIST/ADMIN）
- ✅ SecurityUtils 防止 IDOR 攻击
- ✅ 医生上下文自动注入

#### 2. API 模块化重构
- ✅ 医生工作站 `/api/doctor/**`
- ✅ 护士工作站 `/api/nurse/**`
- ✅ 药师工作站 `/api/pharmacist/**`
- ✅ 公共接口 `/api/common/**`

#### 3. 核心业务模块
- ✅ 挂号模块（患者建档、挂号、取消）
- ✅ 病历管理（创建、更新、查询、提交）
- ✅ 处方管理（创建、审核、价格防篡改）
- ✅ 药品管理（搜索、查询、库存）
- ✅ **患者信息查询（数据脱敏）** ✨

### P1 - 增强功能（待开发）

#### 1. 收费模块
- [ ] 创建收费单
- [ ] 支付回写（幂等性）
- [ ] 退费流程
- [ ] 收费统计

#### 2. 药师工作站完善 ✅
- ✅ 待发药列表
- ✅ 发药操作（自动扣减库存）
- ✅ 退药处理（自动恢复库存）
- ✅ 库存预警（低库存提醒）
- ✅ 库存管理（查询、调整）
- ✅ 工作统计（每日发药统计）

#### 3. 数据一致性
- [ ] 事务边界优化
- [ ] 并发控制（乐观锁）
- [ ] 数据库约束补齐

### P2 - 优化项（长期规划）

#### 1. 性能优化
- [ ] 缓存策略（Redis）
- [ ] 查询优化（索引、分页）
- [ ] N+1 查询解决

#### 2. 安全加固
- [ ] CSRF 防护
- [ ] 会话固定防护
- [ ] 列级加密

#### 3. 监控告警
- [ ] 错误率监控
- [ ] 延迟监控
- [ ] 慢查询告警

---

## 前端开发任务

### P0 - 核心页面（待开发）

#### 1. 基础框架
- [ ] 项目初始化（React/Vue）
- [ ] 路由配置
- [ ] 认证拦截
- [ ] 统一请求封装

#### 2. 主数据管理
- [ ] 科室管理（列表、新增、编辑、启停用）
- [ ] 医生管理（列表、新增、编辑、按科室筛选）
- [ ] 患者建档（列表、新增、编辑、查询）
- [ ] 药品管理（列表、新增、编辑、库存展示）

#### 3. 门诊闭环
- [ ] 挂号页面（创建、取消、列表查询）
- [ ] 病历页面（创建、编辑、草稿、提交、审核）
- [ ] 处方页面（创建、编辑、审核状态）
- [ ] 收费页面（创建、支付、退费）

### P1 - 体验优化

#### 1. 脱敏与权限
- [ ] 敏感信息脱敏展示
- [ ] UI 权限开关（按角色）
- [ ] 详情页明文权限

#### 2. 交互优化
- [ ] 统一加载态
- [ ] 统一错误处理
- [ ] 字段级错误提示

---

## 测试任务

### P0 - 核心测试（已完成）

#### 1. 单元测试
- ✅ 挂号模块测试
- ✅ 病历模块测试
- ✅ 处方模块测试
- ✅ 药品模块测试
- ✅ **药师工作站测试** ✨
  - 处方服务测试（统计、审核、发药）
  - 处方服务实现测试
  - 集成测试（发药流程、退药流程、库存管理）

#### 2. 集成测试
- ✅ 医生工作站集成测试（22个测试用例）
  - ✅ 候诊管理（7个）
  - ✅ **患者信息查询（8个）** ✨
  - ✅ 其他功能（7个）
- ✅ **药师工作站集成测试** ✨
  - ✅ 处方管理集成测试（10+ 测试用例）
  - ✅ 发药流程（库存验证、状态更新）
  - ✅ 退药流程（库存恢复）
  - ✅ 库存管理（查询、预警）
  - ✅ 统计报表（每日统计）
- ✅ 权限控制测试
- ✅ 价格防篡改测试
- ✅ **数据脱敏验证** ✨

### P1 - 测试完善

#### 1. 接口自动化
- [ ] Postman 测试集合
- [ ] CI/CD 集成
- [ ] 回归测试套件

#### 2. 性能测试
- [ ] 并发测试（10并发）
- [ ] 响应时间基准
- [ ] 支付幂等测试

---

## 开发规范

### 接口契约
- 使用 OpenAPI/Swagger 作为唯一标准
- 字段/枚举/状态机变更先改契约
- 统一响应结构：`{ code, message, data, timestamp }`

### 分支策略
- Trunk-based
- `main`：随时可发布
- `feat/*`：短分支（≤2天）

### 数据库迁移
- 生产使用迁移工具（Flyway/Liquibase）
- 只允许增量迁移
- 严禁破坏性操作

### 质量门禁
- 后端：单元测试覆盖关键业务逻辑
- 前端：冒烟脚本/清单
- 交付：每次发布必须可回滚

---

## 相关文档

- [项目企划书](./project-proposal.md)
- [技术架构文档](./技术架构文档.md)
- [医生工作站开发文档](./医生工作站开发文档.md)
- [药师工作站开发文档](./药师工作站开发文档.md) ✨
- [认证与医生上下文指南](./认证与医生上下文使用指南.md)
- [Ubuntu部署指南](./DEPLOY_UBUNTU.md)
